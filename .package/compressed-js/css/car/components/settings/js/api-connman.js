var settings=settings||{};settings.connman=settings.connman||{},settings.connman=function(){function n(e,t){if(wsAPI===undefined)return;wsAPI.sendRequest(WS_REQUEST_TYPE.CONNMAN_MANAGER,"get_technologies",null,function(n){if(n.length>=0&&n[0].length>=0&&n[0][0][0]===undefined){t("Cannot parse technologies");return}var r=n[0];try{var i=[];for(var s=0;s<r.length;s++){(r[s][0]===undefined||r[s][1]===undefined)&&console.log("Badly form json message: "+json_msg);var o=new settings.connman.ConnmanTechnology(r[s][0],r[s][1]);i.push(o)}}catch(u){t(u)}e(i)},t)}function r(e,t){if(wsAPI===undefined)return;wsAPI.sendRequest(WS_REQUEST_TYPE.CONNMAN_MANAGER,"get_services",null,function(n){if(n.length>=0&&n[0].length>=0&&n[0][0][0]===undefined){t("Cannot parse get_services results");return}var r=n[0];try{var n=[];for(var i=0;i<r.length;i++){(r[i][0]===undefined||r[i][1]===undefined)&&console.log("Badly form json message: "+json_msg);var s=new settings.connman.ConnmanService(r[i][0],r[i][1]);n.push(s)}}catch(o){t(o)}e(n)},t)}function i(e,t,n){if(wsAPI===undefined)return;wsAPI.sendRequest(WS_REQUEST_TYPE.CONNMAN_TECHNOLOGY,"scan",[e,null],function(e){if(e.length>=0&&e[0].length>=0&&e[0][0][0]===undefined){n("Cannot parse scan results");return}var r=e[0];try{var i=[];for(var s=0;s<r.length;s++){(r[s][0]===undefined||r[s][1]===undefined)&&console.log("Badly form json message: "+json_msg);var o=new settings.connman.ConnmanService(r[s][0],r[s][1]);i.push(o)}}catch(u){n(u)}t(i)},n)}var e=null,t=function(e,t){this.id=e,this.prop=t};return t.prototype.setPowered=function(e,t,n){if(wsAPI===undefined)return;if(this.setPowerInProgress){console.log("Enabling/disabling technology in progress");return}var r=this;this.setPowerInProgress=!0,setTimeout(function(){wsAPI.sendRequest(WS_REQUEST_TYPE.CONNMAN_TECHNOLOGY,"enable",[r.id,e],function(){r.setPowerInProgress=!1,t()},function(e){e.indexOf("Already enabled")>=0?(console.log("connman "+r.prop.Type+" already enabled"),r.setPowerInProgress=!1,t()):e.indexOf("Already disabled")>=0?(console.log("connman "+r.prop.Type+" already disabled"),r.setPowerInProgress=!1,t()):(r.setPowerInProgress=!1,n(e))})},2e3)},t.prototype.getPowered=function(e,t){if(wsAPI===undefined)return;var n=this;wsAPI.sendRequest(this.prop.Type,"is_enabled",null,function(t){t===undefined&&console.log("Badly formed json message: "+json_msg),n.powered=t,e(n.powered)},t)},t.prototype.setTethering=function(e,t,n,r,i){if(wsAPI===undefined)return;var s=this,o=s.id.lastIndexOf("/"),u=s.id.substring(o+1).toString().trim().toLowerCase();if(u!=="wifi")return;var a={path:s.id,ssid:e===undefined?s.prop.TetheringIdentifier:e,password:t===undefined?s.prop.TetheringPassphrase:t,enabled:n===undefined?s.prop.Tethering:n};wsAPI.sendRequest(WS_REQUEST_TYPE.CONNMAN_TECHNOLOGY,"set_tethering",a,function(){!r||r()},function(e){!i||i(e)})},ConnmanService=function(e,t){this.id=e,this.prop=t},ConnmanService.prototype.connect=function(e,t,n,r,i){if(wsAPI===undefined)return;var s=[this.id,{Name:e===undefined?this.prop.Name:e,Type:n===undefined?this.prop.EncryptionMode:n,Passphrase:t}];wsAPI.sendRequest(WS_REQUEST_TYPE.CONNMAN_SERVICE,"connect",s,r,i)},ConnmanService.prototype.disconnect=function(e,t){if(wsAPI===undefined)return;wsAPI.sendRequest(WS_REQUEST_TYPE.CONNMAN_SERVICE,"disconnect",[this.id,null],e,t)},ConnmanService.prototype.setAutoConnect=function(e,t,n){if(wsAPI===undefined)return;var r=this;if(!!r.prop&&r.prop.Type!=="wifi")return;var i={path:r.id,enable:e===undefined?r.prop.AutoConnect:e};wsAPI.sendRequest(WS_REQUEST_TYPE.CONNMAN_SERVICE,"autoconnect",i,function(){!t||t()},function(e){!n||n(e)})},{ConnmanTechnology:t,ConnmanService:ConnmanService,getTechnologies:n,getServices:r,scan:i}}()