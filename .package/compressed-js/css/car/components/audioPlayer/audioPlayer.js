(function(e){"use strict";var t={thisObj:null,model:[],player:null,playerType:"AUDIO",audio:null,video:null,timeUpdateListenerLoaded:!1,audioPlayerService:null,ctrlButtonsSelector:null,timeProgressBarSelelector:null,spectrumAnalyzerSelelector:null,infoPanelSelector:null,thumbnailSelector:null,volumeControlSelector:null,repeatOn:!1,shuffleOn:!1,playOn:!1,index:0,position:0,currentTime:0,duration:0,volume:100,indexChangedCallback:null,setSpectrumAnalyzerSelector:function(e){t.spectrumAnalyzerSelelector=e},setControlButtonsSelector:function(e){t.ctrlButtonsSelector=e},setTimeProgressBarSelector:function(e){t.timeProgressBarSelelector=e},setInfoPanelSelector:function(e){t.infoPanelSelector=e},setThumbnailSelector:function(e){t.thumbnailSelector=e},setVolumeControlSelector:function(e){t.volumeControlSelector=e},addIndexChangeListener:function(e){t.indexChangeCallback=e},init:function(n,r,i){t.thisObj=this,!!n&&n.length&&(t.model=n),!!r&&r!==""&&(t.audio=e(r).get(0)),!!i&&i!==""&&(t.video=e(i).get(0)),t.audio?(t.player=t.audio,t.playerType="AUDIO"):!t.video||(t.player=t.video,t.playerType="VIDEO"),t.ctrlButtonsSelector!==null&&(e(t.ctrlButtonsSelector).buttonControls("initAudioPlayerButtons"),e(t.ctrlButtonsSelector).unbind(),e(t.ctrlButtonsSelector).bind("previousSong",function(){console.log("previousSong clicked"),t.previous()}),e(t.ctrlButtonsSelector).bind("nextSong",function(){console.log("nextSong clicked"),t.next()}),e(t.ctrlButtonsSelector).bind("playSong",function(){console.log("playSong clicked"),t.playOn=!t.playOn,t.playPause(t.playOn)}),e(t.ctrlButtonsSelector).bind("shuffleSong",function(){console.log("shuffleSong clicked"),t.shuffleOn=!t.shuffleOn,t.updateUIControls()}),e(t.ctrlButtonsSelector).bind("repeatSong",function(){console.log("repeatSong clicked"),t.repeatOn=!t.repeatOn,t.updateUIControls()}));if(t.volumeControlSelector!==null){var s=50;localStorage&&localStorage.volume&&(s=localStorage.volume),e(t.volumeControlSelector).noUiSlider({range:[0,100],step:1,start:s,handles:1,connect:"lower",orientation:"horizontal",slide:function(n,r){var i=parseInt(e(t.volumeControlSelector).val(),10);console.log("new volume: "+i),t.volume=i,t.setAudioVolume(i)}}),t.setAudioVolume(s)}t.timeProgressBarSelelector!==null&&(e(t.timeProgressBarSelelector).timeProgressBar("init"),e(t.timeProgressBarSelelector).bind("positionChanged",function(e,n){console.log("positionChanged "+n.position),t.setAudioPosition(n.position)})),t.registerPlayerListeners(t.audio,"AUDIO"),t.registerPlayerListeners(t.video,"VIDEO"),t.updateUIControls()},registerPlayerListeners:function(e,n){!e||(e.addEventListener("canplay",function(){console.log("canplay "+n),t.playPause(t.playOn)},!1),e.addEventListener("canplaythrough",function(){console.log("canplaythrough "+n),t.playPause(t.playOn)},!1),e.addEventListener("play",function(){console.log("play "+n)},!1),e.addEventListener("playing",function(){console.log("playing "+n)},!1),e.addEventListener("error",function(){console.log("error "+n)},!1),e.addEventListener("waiting",function(){console.log("waiting "+n)},!1),e.addEventListener("timeupdate",function(){!!e.currentTime&&!isNaN(e.currentTime)&&e.currentTime!=="Infinity"&&e.currentTime>0&&!!e.duration&&!isNaN(e.duration)&&e.duration!=="Infinity"&&e.duration>0&&(t.currentTime=e.currentTime,t.duration=e.duration),t.updateProgressInfoPanel(),t.spectrumAnalyzer(t.playOn)},!1),e.addEventListener("ended",function(){t.next()}))},playAudioContent:function(e,n,r,i){!t.player||(t.player.pause(),t.player.src=""),t.model=e,t.playOn=r,t.playerType=i,i==="AUDIO"?t.player=t.audio:i==="VIDEO"&&(t.player=t.video),t.loadAudio(n)},updateUIControls:function(){t.playPauseButtons(t.playOn),t.shuffleButton(t.shuffleOn),t.repeatButton(t.repeatOn),t.nextButton(t.index,t.repeatOn,t.shuffleOn),t.previousButton(t.index,t.repeatOn,t.shuffleOn),t.spectrumAnalyzer(t.playOn),t.volumeControl(t.volume),t.updateAudioInfoPanel(t.index),t.updateProgressInfoPanel()},playPauseButtons:function(n){t.ctrlButtonsSelector!==null&&(n?e(t.ctrlButtonsSelector).buttonControls("buttonPauseActive"):e(t.ctrlButtonsSelector).buttonControls("buttonPlayActive"))},shuffleButton:function(n){t.ctrlButtonsSelector!==null&&(n?e(t.ctrlButtonsSelector).buttonControls("buttonShuffleActive"):e(t.ctrlButtonsSelector).buttonControls("buttonShuffleInactive"))},repeatButton:function(n){t.ctrlButtonsSelector!==null&&(n?e(t.ctrlButtonsSelector).buttonControls("buttonRepeatActive"):e(t.ctrlButtonsSelector).buttonControls("buttonRepeatInactive"))},nextButton:function(n,r,i){t.ctrlButtonsSelector!==null&&(r||i||n<t.model.length-1?e(t.ctrlButtonsSelector).buttonControls("buttonNextActive"):e(t.ctrlButtonsSelector).buttonControls("buttonNextInactive"))},previousButton:function(n,r,i){t.ctrlButtonsSelector!==null&&(r||i||n>0?e(t.ctrlButtonsSelector).buttonControls("buttonPreviousActive"):e(t.ctrlButtonsSelector).buttonControls("buttonPreviousInactive"))},spectrumAnalyzer:function(n){t.spectrumAnalyzerSelelector!==null&&(n?e(t.spectrumAnalyzerSelelector).spectrumAnalyzer("spectrumAnalyzerRandomize"):e(t.spectrumAnalyzerSelelector).spectrumAnalyzer("clearSpectrumAnalyzer"))},volumeControl:function(n){n>100?n=100:n<0&&(n=0),t.volume=n,t.volumeControlSelector!==null&&e(t.volumeControlSelector).val(n),t.setAudioVolume(n)},setAudioVolume:function(e){e>100?e=100:e<0&&(e=0),t.volume=e,t.player.volume=e/100,localStorage&&(localStorage.volume=e)},updateAudioInfoPanel:function(n){if(t.model.length&&n>=0&&n<t.model.length){var r=t.model[n],i={};!r||(t.infoPanelSelector!==null&&(i.title="NOW PLAYING",i.artist=Utils.getArtistName(r),i.album=Utils.getAlbumName(r),i.name=Utils.getMediaItemTitle(r),e(t.infoPanelSelector).infoPanel("show",i)),t.thumbnailSelector!==null&&(e(t.thumbnailSelector).get(0).src=Utils.getThumbnailPath(r,t.playerType)))}},updateProgressInfoPanel:function(){t.duration<0&&(t.duration=0),t.currentTime<0&&(t.currentTime=0),t.currentTime>t.duration&&(t.currentTime=t.duration),t.position=t.currentTime/t.duration*100,t.position<0&&(t.position=0),t.position>100&&(t.position=100);var n=t.duration-t.currentTime,r=Math.floor(n/60,10),i=Math.round(n)-r*60,s="-"+r+":"+(i>9?i:"0"+i),o={count:t.model.length,index:t.model.length<=0?0:t.index+1,estimation:s,position:t.position};t.timeProgressBarSelelector!==null&&e(t.timeProgressBarSelelector).timeProgressBar("show",o)},loadAudio:function(e,n){if(!t.model.length||e<0||e>t.model.length-1||!t.player)return;t.player.pause(),t.player.src="",t.index=e,t.position=0,t.currentTime=0,t.duration=0;var r=t.model[e];!r||(!!r.contentURI&&r.contentURI!==""&&(typeof n=="undefined"?(t.player.src=r.contentURI,t.player.load()):setTimeout(function(){t.player.src=r.contentURI,t.player.load()},n)),!!r.duration&&r.duration>=0&&(t.duration=r.duration/1e3)),t.updateUIControls()},play:function(e){e!==t.index&&t.loadAudio(e)},setAudioPosition:function(e){e>100?e=100:e<0&&(e=0),t.currentTime=e/100*t.duration,!t.player||(t.player.currentTime=t.currentTime),t.updateProgressInfoPanel()},playPause:function(e){t.playOn=e,!t.player||t.player.currentSrc===""?t.playOn=!1:t.playOn?t.player.play():t.player.pause(),t.updateUIControls()},next:function(){if(t.model.length){var e=t.index,n=t.index;if(t.shuffleOn)while(e===t.index)e=Math.floor(Math.random()*t.model.length);else t.repeatOn&&t.index>=t.model.length-1?e=0:t.index<t.model.length-1?e=t.index+1:t.playOn=!1;e!==n&&!!t.indexChangeCallback&&t.indexChangeCallback(e),t.loadAudio(e,150)}},previous:function(){if(t.model.length){var e=t.index,n=t.index;if(t.shuffleOn)while(e===t.index)e=Math.floor(Math.random()*t.model.length);else t.repeatOn&&t.index<=0?e=t.model.length-1:t.index>0&&(e=t.index-1);e!==n&&!!t.indexChangeCallback&&t.indexChangeCallback(e),t.loadAudio(e,150)}},getCurrentPlayerType:function(){return t.playerType}};e.fn.audioAPI=function(n){if(t[n])return t[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return t.init.apply(this,arguments);e.error("Method "+n+" does not exist on jQuery.audioAPI")}})(jQuery)